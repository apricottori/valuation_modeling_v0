<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valuation Assistant</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- 인증 컨테이너 (로그인/회원가입) -->
    <div id="auth-container" class="auth-container">
        <div class="auth-content">
            <div class="auth-header">
                <h1>Valuation Assistant</h1>
                <p>기업 가치 평가를 위한 전문 도구</p>
            </div>
            
            <!-- 로그인 폼 -->
            <div id="login-form" class="auth-form active">
                <h2>로그인</h2>
                <div class="form-group">
                    <label for="login-email">이메일</label>
                    <input type="email" id="login-email" placeholder="이메일을 입력하세요" required>
                </div>
                <div class="form-group">
                    <label for="login-password">비밀번호</label>
                    <input type="password" id="login-password" placeholder="비밀번호를 입력하세요" required>
                </div>
                <div class="form-group checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="login-remember">
                        <span class="checkmark"></span>
                        로그인 상태 유지
                    </label>
                </div>
                <button type="button" id="login-btn" class="btn-primary">로그인</button>
                <div class="auth-links">
                    <a href="#" id="forgot-password-link">비밀번호를 잊으셨나요?</a>
                    <a href="#" id="show-signup-link">회원가입</a>
                </div>
            </div>
            
            <!-- 회원가입 폼 -->
            <div id="signup-form" class="auth-form">
                <h2>회원가입</h2>
                <div class="form-group">
                    <label for="signup-email">이메일</label>
                    <input type="email" id="signup-email" placeholder="이메일을 입력하세요" required>
                </div>
                <div class="form-group">
                    <label for="signup-password">비밀번호</label>
                    <input type="password" id="signup-password" placeholder="비밀번호를 입력하세요 (최소 6자)" required>
                </div>
                <div class="form-group">
                    <label for="signup-confirm-password">비밀번호 확인</label>
                    <input type="password" id="signup-confirm-password" placeholder="비밀번호를 다시 입력하세요" required>
                </div>
                <button type="button" id="signup-btn" class="btn-primary">회원가입</button>
                <div class="auth-links">
                    <a href="#" id="show-login-link">이미 계정이 있으신가요? 로그인</a>
                </div>
            </div>
            
            <!-- 비밀번호 재설정 폼 -->
            <div id="reset-form" class="auth-form">
                <h2>비밀번호 재설정</h2>
                <p>이메일 주소를 입력하시면 비밀번호 재설정 링크를 보내드립니다.</p>
                <div class="form-group">
                    <label for="reset-email">이메일</label>
                    <input type="email" id="reset-email" placeholder="이메일을 입력하세요" required>
                </div>
                <button type="button" id="reset-btn" class="btn-primary">재설정 링크 보내기</button>
                <div class="auth-links">
                    <a href="#" id="back-to-login-link">로그인으로 돌아가기</a>
                </div>
            </div>
            
            <!-- 오류 메시지 영역 -->
            <div id="auth-error" class="auth-error" style="display: none;"></div>
        </div>
    </div>

    <!-- 앱 컨테이너 -->
    <div id="app-container" class="app-container" style="display: none;">
        <div class="container">
            <!-- 헤더 -->
            <header class="header">
                <!-- 로그인 상태 표시 (우측 상단) -->
                <div class="login-container">
                    <!-- Firebase에서 동적으로 업데이트됨 -->
                </div>
            
            <h1>Valuation Assistant</h1>
            <nav class="nav-steps">
                <div class="step active" data-step="1">
                    <span class="step-number">1</span>
                    <span class="step-title">재무 구조 분석</span>
                </div>
                <div class="step" data-step="2">
                    <span class="step-number">2</span>
                    <span class="step-title">시나리오 모델링</span>
                </div>
                <div class="step" data-step="3">
                    <span class="step-number">3</span>
                    <span class="step-title">모델 시각화</span>
                </div>
                <div class="step" data-step="4">
                    <span class="step-number">4</span>
                    <span class="step-title">시뮬레이션</span>
                </div>
                <div class="step" data-step="5">
                    <span class="step-number">5</span>
                    <span class="step-title">투자 분석</span>
                </div>
            </nav>
            <!-- 데이터 관리 버튼 -->
            <div class="data-actions-header">
                <button type="button" id="exportData" class="btn-export">데이터 내보내기</button>
                <button type="button" id="importData" class="btn-import">데이터 가져오기</button>
                <input type="file" id="importFile" accept=".json" style="display: none;">
            </div>
        </header>

        <!-- 메인 컨텐츠 -->
        <main class="main-content">
            <!-- Page 1: 재무 구조 분석 -->
            <div class="page active" id="page1">
                <div class="page-header">
                    <h2>재무 구조 분석</h2>
                    <span class="unit-subtitle">단위: Million (백만원)</span>
                </div>
                <div class="form-section">
                    <h3>기업 정보</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="companyName">기업명</label>
                            <div class="input-with-button">
                                <input type="text" id="companyName" placeholder="기업명을 입력하세요" autocomplete="off">
                                <button type="button" id="analyzeCompanyInline" class="btn-ai-inline">AI 분석</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>핵심 가정</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="discountRate">할인율 (%)</label>
                            <input type="number" id="discountRate" value="10" step="0.1" min="0" max="50">
                        </div>
                        <div class="form-group">
                            <label for="taxRate">법인세율 (%)</label>
                            <input type="number" id="taxRate" value="25" step="0.1" min="0" max="50">
                        </div>
                        <div class="form-group">
                            <label for="forecastPeriod">예측 기간 (년)</label>
                            <input type="number" id="forecastPeriod" value="15" min="1" max="30">
                        </div>
                        <div class="form-group">
                            <label for="terminalGrowthRate">영구 성장률 (%)</label>
                            <input type="number" id="terminalGrowthRate" value="2.5" step="0.1" min="0" max="10">
                        </div>
                        <div class="form-group">
                            <label for="marketValue">현재 기업가치</label>
                            <input type="text" id="marketValue" placeholder="현재 기업가치를 입력하세요">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>AI 기업 분석</h3>
                    <div class="form-group">
                        <label for="apiKey">Google AI Studio API 키</label>
                        <input type="password" id="apiKey" placeholder="Google AI Studio에서 발급받은 API 키를 입력하세요">
                        <small class="form-help">
                            <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer">API 키 발급받기</a>
                        </small>
                    </div>
                    <button type="button" id="analyzeCompany" class="btn-primary">기업 분석 요청</button>
                    <div id="aiAnalysisResult" class="ai-analysis-box" style="display: none;">
                        <h4>AI 분석 결과</h4>
                        <div id="aiAnalysisContent"></div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>재무 데이터 자동 로딩</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="tickerSymbol">티커 심볼</label>
                            <input type="text" id="tickerSymbol" placeholder="자동으로 입력됩니다" maxlength="10" readonly>
                        </div>
                        <div class="form-group">
                            <label for="dataSource">데이터 소스</label>
                            <select id="dataSource">
                                <option value="alpha_vantage">Alpha Vantage</option>
                                <option value="yahoo_finance">Yahoo Finance</option>
                                <option value="financial_modeling_prep">Financial Modeling Prep</option>
                            </select>
                        </div>
                        <!-- 재무 데이터 API 키 입력 필드 (Alpha Vantage는 하드코딩됨) -->
                        <!--
                        <div class="form-group">
                            <label for="financialApiKey">재무 데이터 API 키</label>
                            <input type="password" id="financialApiKey" placeholder="Alpha Vantage 또는 Financial Modeling Prep API 키">
                            <small class="form-help">
                                <a href="https://www.alphavantage.co/support/#api-key" target="_blank" rel="noopener noreferrer">Alpha Vantage API 키 발급</a> | 
                                <a href="https://financialmodelingprep.com/developer/docs/" target="_blank" rel="noopener noreferrer">Financial Modeling Prep API 키 발급</a>
                            </small>
                        </div>
                        -->
                    </div>
                    <div class="data-source-actions">
                        <button type="button" id="loadFinancialData" class="btn-primary">재무 데이터 로딩</button>
                    </div>
                    
                    <div id="financialDataResult" class="financial-data-box" style="display: none;">
                        <h4>로딩된 재무 데이터</h4>
                        <div class="financial-data-content">
                            <div class="data-loading" id="dataLoading">
                                <div class="loading-spinner"></div>
                                <p>재무 데이터를 로딩 중입니다...</p>
                            </div>
                            <div class="data-content" id="dataContent" style="display: none;">
                                <!-- 손익계산서 테이블 -->
                                <div class="financial-table-section">
                                    <h5>최근 3개년 손익계산서</h5>
                                    <div class="table-container">
                                        <table class="financial-table" id="incomeStatementTable">
                                            <thead>
                                                <tr>
                                                    <th>항목</th>
                                                    <th id="year1">2023</th>
                                                    <th id="year2">2022</th>
                                                    <th id="year3">2021</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>매출</td>
                                                    <td id="revenue1">-</td>
                                                    <td id="revenue2">-</td>
                                                    <td id="revenue3">-</td>
                                                </tr>
                                                <tr>
                                                    <td>매출원가</td>
                                                    <td id="cogs1">-</td>
                                                    <td id="cogs2">-</td>
                                                    <td id="cogs3">-</td>
                                                </tr>
                                                <tr>
                                                    <td>매출총이익</td>
                                                    <td id="grossProfit1">-</td>
                                                    <td id="grossProfit2">-</td>
                                                    <td id="grossProfit3">-</td>
                                                </tr>
                                                <tr>
                                                    <td>판매 및 관리비</td>
                                                    <td id="sellingGeneralAndAdmin1">-</td>
                                                    <td id="sellingGeneralAndAdmin2">-</td>
                                                    <td id="sellingGeneralAndAdmin3">-</td>
                                                </tr>
                                                <tr>
                                                    <td>연구개발비</td>
                                                    <td id="researchAndDevelopment1">-</td>
                                                    <td id="researchAndDevelopment2">-</td>
                                                    <td id="researchAndDevelopment3">-</td>
                                                </tr>
                                                <tr>
                                                    <td>영업이익</td>
                                                    <td id="operatingIncome1">-</td>
                                                    <td id="operatingIncome2">-</td>
                                                    <td id="operatingIncome3">-</td>
                                                </tr>
                                                <tr>
                                                    <td>순이익</td>
                                                    <td id="netIncome1">-</td>
                                                    <td id="netIncome2">-</td>
                                                    <td id="netIncome3">-</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- 재무상태표 테이블 -->
                                <div class="financial-table-section">
                                    <h5>최근 3개년 재무상태표</h5>
                                    <div class="table-container">
                                        <table class="financial-table" id="balanceSheetTable">
                                            <thead>
                                                <tr>
                                                    <th>항목</th>
                                                    <th id="bsYear1">2023</th>
                                                    <th id="bsYear2">2022</th>
                                                    <th id="bsYear3">2021</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>총자산</td>
                                                    <td id="totalAssets1">-</td>
                                                    <td id="totalAssets2">-</td>
                                                    <td id="totalAssets3">-</td>
                                                </tr>
                                                <tr>
                                                    <td>유동자산</td>
                                                    <td id="currentAssets1">-</td>
                                                    <td id="currentAssets2">-</td>
                                                    <td id="currentAssets3">-</td>
                                                </tr>
                                                <tr>
                                                    <td>총부채</td>
                                                    <td id="totalLiabilities1">-</td>
                                                    <td id="totalLiabilities2">-</td>
                                                    <td id="totalLiabilities3">-</td>
                                                </tr>
                                                <tr>
                                                    <td>유동부채</td>
                                                    <td id="currentLiabilities1">-</td>
                                                    <td id="currentLiabilities2">-</td>
                                                    <td id="currentLiabilities3">-</td>
                                                </tr>
                                                <tr>
                                                    <td>자본총계</td>
                                                    <td id="totalEquity1">-</td>
                                                    <td id="totalEquity2">-</td>
                                                    <td id="totalEquity3">-</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- 현금흐름표 테이블 -->
                                <div class="financial-table-section">
                                    <h5>최근 3개년 현금흐름표</h5>
                                    <div class="table-container">
                                        <table class="financial-table" id="cashFlowTable">
                                            <thead>
                                                <tr>
                                                    <th>항목</th>
                                                    <th id="cfYear1">2023</th>
                                                    <th id="cfYear2">2022</th>
                                                    <th id="cfYear3">2021</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>감가상각</td>
                                                    <td id="depreciation1">-</td>
                                                    <td id="depreciation2">-</td>
                                                    <td id="depreciation3">-</td>
                                                </tr>
                                                <tr>
                                                    <td>영업현금흐름</td>
                                                    <td id="operatingCashFlow1">-</td>
                                                    <td id="operatingCashFlow2">-</td>
                                                    <td id="operatingCashFlow3">-</td>
                                                </tr>
                                                <tr>
                                                    <td>투자현금흐름</td>
                                                    <td id="investingCashFlow1">-</td>
                                                    <td id="investingCashFlow2">-</td>
                                                    <td id="investingCashFlow3">-</td>
                                                </tr>
                                                <tr>
                                                    <td>재무현금흐름</td>
                                                    <td id="financingCashFlow1">-</td>
                                                    <td id="financingCashFlow2">-</td>
                                                    <td id="financingCashFlow3">-</td>
                                                </tr>
                                                <tr>
                                                    <td>자유현금흐름</td>
                                                    <td id="freeCashFlow1">-</td>
                                                    <td id="freeCashFlow2">-</td>
                                                    <td id="freeCashFlow3">-</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="data-actions">
                                    <button type="button" id="applyFinancialData" class="btn-secondary">최신 데이터 적용</button>
                                    <button type="button" id="clearFinancialData" class="btn-secondary">초기화</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>손익계산서 (기준 연도)</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>매출</label>
                            <input type="text" id="revenue" placeholder="매출액" min="0">
                        </div>
                        <div class="form-group">
                            <label>매출원가</label>
                            <input type="text" id="costOfGoodsSold" placeholder="매출원가" min="0">
                        </div>
                        <div class="form-group">
                            <label>매출총이익</label>
                            <input type="text" id="grossProfit" placeholder="매출총이익" readonly>
                        </div>
                        <div class="form-group">
                            <label>영업이익 (EBIT)</label>
                            <input type="text" id="operatingIncome" placeholder="영업이익" min="0">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>사업부문 설정</h3>
                    <div id="businessSegments">
                        <div class="segment-item">
                            <div class="segment-input-group">
                                <label>사업부문</label>
                                <input type="text" placeholder="사업부문명" class="segment-name">
                            </div>
                            <div class="segment-input-group">
                                <label>매출액</label>
                                <input type="text" placeholder="매출액" class="segment-revenue" min="0">
                            </div>
                            <button type="button" class="btn-remove-segment">삭제</button>
                        </div>
                    </div>
                    <button type="button" id="addSegment" class="btn-secondary">+ 사업부문 추가</button>
                    
                    <!-- 기타 사업부문 (자동 계산) -->
                    <div class="segment-item other-segment">
                        <div class="segment-input-group">
                            <label>사업부문</label>
                            <input type="text" value="기타 (Other)" readonly>
                        </div>
                        <div class="segment-input-group">
                            <label>매출액</label>
                            <input type="text" id="other-segment-revenue" placeholder="자동 계산" readonly>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>비용 구조 분석</h3>
                    <div class="cost-structure">
                        <!-- 고정 비용 항목: 매출원가 -->
                        <div class="cost-item fixed-cost">
                            <label>매출원가</label>
                            <div class="cost-input-group">
                                <label>금액</label>
                                <input type="text" id="cogs-amount" placeholder="금액" min="0" readonly>
                            </div>
                            <div class="slider-container">
                                <div class="slider-group">
                                    <div class="ratio-display-new">
                                        <span class="variable-label-new">변동비</span>
                                        <span class="variable-ratio-new" id="cogs-variable-value">80%</span>
                                        <span class="ratio-separator-new">-</span>
                                        <span class="fixed-ratio-new" id="cogs-fixed-value">20%</span>
                                        <span class="fixed-label-new">고정비</span>
                                    </div>
                                    <input type="range" id="cogs-variable" class="slider-input" value="80" min="0" max="100">
                                </div>
                            </div>
                        </div>
                        
                        <!-- 기본 비용 항목들 -->
                        <div class="cost-item dynamic-cost" data-cost-type="depreciation">
                            <div class="cost-item-header">
                                <label>감가상각비</label>
                                <button type="button" class="btn-remove-cost" title="비용 항목 삭제">×</button>
                            </div>
                            <div class="cost-input-group">
                                <label>금액</label>
                                <input type="text" id="depreciation-amount" placeholder="금액" min="0">
                            </div>
                            <div class="slider-container">
                                <div class="slider-group">
                                    <div class="ratio-display-new">
                                        <span class="variable-label-new">변동비</span>
                                        <span class="variable-ratio-new" id="depreciation-variable-value">0%</span>
                                        <span class="ratio-separator-new">-</span>
                                        <span class="fixed-ratio-new" id="depreciation-fixed-value">100%</span>
                                        <span class="fixed-label-new">고정비</span>
                                    </div>
                                    <input type="range" id="depreciation-variable" class="slider-input" value="0" min="0" max="100">
                                </div>
                            </div>
                        </div>
                        
                        <div class="cost-item dynamic-cost" data-cost-type="labor">
                            <div class="cost-item-header">
                                <label>인건비</label>
                                <button type="button" class="btn-remove-cost" title="비용 항목 삭제">×</button>
                            </div>
                            <div class="cost-input-group">
                                <label>금액</label>
                                <input type="text" id="labor-amount" placeholder="금액" min="0">
                            </div>
                            <div class="slider-container">
                                <div class="slider-group">
                                    <div class="ratio-display-new">
                                        <span class="variable-label-new">변동비</span>
                                        <span class="variable-ratio-new" id="labor-variable-value">30%</span>
                                        <span class="ratio-separator-new">-</span>
                                        <span class="fixed-ratio-new" id="labor-fixed-value">70%</span>
                                        <span class="fixed-label-new">고정비</span>
                                    </div>
                                    <input type="range" id="labor-variable" class="slider-input" value="30" min="0" max="100">
                                </div>
                            </div>
                        </div>
                        
                        <div class="cost-item dynamic-cost" data-cost-type="rd">
                            <div class="cost-item-header">
                                <label>연구개발비</label>
                                <button type="button" class="btn-remove-cost" title="비용 항목 삭제">×</button>
                            </div>
                            <div class="cost-input-group">
                                <label>금액</label>
                                <input type="text" id="rd-amount" placeholder="금액" min="0">
                            </div>
                            <div class="slider-container">
                                <div class="slider-group">
                                    <div class="ratio-display-new">
                                        <span class="variable-label-new">변동비</span>
                                        <span class="variable-ratio-new" id="rd-variable-value">20%</span>
                                        <span class="ratio-separator-new">-</span>
                                        <span class="fixed-ratio-new" id="rd-fixed-value">80%</span>
                                        <span class="fixed-label-new">고정비</span>
                                    </div>
                                    <input type="range" id="rd-variable" class="slider-input" value="20" min="0" max="100">
                                </div>
                            </div>
                        </div>
                        
                        <div class="cost-item dynamic-cost" data-cost-type="advertising">
                            <div class="cost-item-header">
                                <label>광고선전비</label>
                                <button type="button" class="btn-remove-cost" title="비용 항목 삭제">×</button>
                            </div>
                            <div class="cost-input-group">
                                <label>금액</label>
                                <input type="text" id="advertising-amount" placeholder="금액" min="0">
                            </div>
                            <div class="slider-container">
                                <div class="slider-group">
                                    <div class="ratio-display-new">
                                        <span class="variable-label-new">변동비</span>
                                        <span class="variable-ratio-new" id="advertising-variable-value">60%</span>
                                        <span class="ratio-separator-new">-</span>
                                        <span class="fixed-ratio-new" id="advertising-fixed-value">40%</span>
                                        <span class="fixed-label-new">고정비</span>
                                    </div>
                                    <input type="range" id="advertising-variable" class="slider-input" value="60" min="0" max="100">
                                </div>
                            </div>
                        </div>
                        
                        <!-- 고정 비용 항목: 기타 비용 -->
                        <div class="cost-item other-cost fixed-cost">
                            <label>기타 비용</label>
                            <div class="cost-input-group">
                                <label>금액</label>
                                <input type="text" id="other-amount" placeholder="금액" min="0" readonly>
                            </div>
                            <div class="slider-container">
                                <div class="slider-group">
                                    <div class="ratio-display-new">
                                        <span class="variable-label-new">변동비</span>
                                        <span class="variable-ratio-new" id="other-variable-value">40%</span>
                                        <span class="ratio-separator-new">-</span>
                                        <span class="fixed-ratio-new" id="other-fixed-value">60%</span>
                                        <span class="fixed-label-new">고정비</span>
                                    </div>
                                    <input type="range" id="other-variable" class="slider-input" value="40" min="0" max="100">
                                </div>
                            </div>
                        </div>
                        
                        <!-- 동적 비용 항목들 (새로 추가되는 항목들) -->
                        <div id="dynamicCostItems">
                            <!-- 동적으로 추가되는 비용 항목들이 여기에 들어갑니다 -->
                        </div>
                        
                        <!-- 비용 항목 추가 버튼 -->
                        <div class="cost-item-add">
                            <button type="button" id="addCostItem" class="btn-secondary">
                                <span>+</span> 비용 항목 추가
                            </button>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="cost-model-check">
                        <button type="button" id="costModelCheck" class="btn-primary">Cost Model Check</button>
                    </div>
                </div>



                <div class="form-actions">
                    <button type="button" id="nextToPage2" class="btn-primary">다음 단계로</button>
                </div>
            </div>

            <!-- Page 2: 확률론적 시나리오 모델링 -->
            <div class="page" id="page2">
                <h2>확률론적 시나리오 모델링</h2>
                <div id="segmentScenarios">
                    <!-- 사업부문별 시나리오가 동적으로 생성됨 -->
                </div>
                
                <div class="form-section">
                    <h3>고정비 성장률 시나리오</h3>
                    <div class="fixed-cost-scenarios">
                        <div class="cost-scenario">
                            <label>매출원가 고정비</label>
                            <div class="scenario-input-group">
                                <label>평균 성장률 (%)</label>
                                <input type="number" id="cogs-fixed-mean" placeholder="평균 성장률 (%)" step="0.1">
                            </div>
                            <div class="scenario-input-group">
                                <label>표준편차 (%)</label>
                                <input type="number" id="cogs-fixed-std" placeholder="표준편차 (%)" step="0.1">
                            </div>
                        </div>
                        <div class="cost-scenario">
                            <label>감가상각비</label>
                            <div class="scenario-input-group">
                                <label>평균 성장률 (%)</label>
                                <input type="number" id="depreciation-fixed-mean" placeholder="평균 성장률 (%)" step="0.1">
                            </div>
                            <div class="scenario-input-group">
                                <label>표준편차 (%)</label>
                                <input type="number" id="depreciation-fixed-std" placeholder="표준편차 (%)" step="0.1">
                            </div>
                        </div>
                        <div class="cost-scenario">
                            <label>인건비 고정비</label>
                            <div class="scenario-input-group">
                                <label>평균 성장률 (%)</label>
                                <input type="number" id="labor-fixed-mean" placeholder="평균 성장률 (%)" step="0.1">
                            </div>
                            <div class="scenario-input-group">
                                <label>표준편차 (%)</label>
                                <input type="number" id="labor-fixed-std" placeholder="표준편차 (%)" step="0.1">
                            </div>
                        </div>
                        <div class="cost-scenario">
                            <label>연구개발비 고정비</label>
                            <div class="scenario-input-group">
                                <label>평균 성장률 (%)</label>
                                <input type="number" id="rd-fixed-mean" placeholder="평균 성장률 (%)" step="0.1">
                            </div>
                            <div class="scenario-input-group">
                                <label>표준편차 (%)</label>
                                <input type="number" id="rd-fixed-std" placeholder="표준편차 (%)" step="0.1">
                            </div>
                        </div>
                        <div class="cost-scenario">
                            <label>광고선전비 고정비</label>
                            <div class="scenario-input-group">
                                <label>평균 성장률 (%)</label>
                                <input type="number" id="advertising-fixed-mean" placeholder="평균 성장률 (%)" step="0.1">
                            </div>
                            <div class="scenario-input-group">
                                <label>표준편차 (%)</label>
                                <input type="number" id="advertising-fixed-std" placeholder="표준편차 (%)" step="0.1">
                            </div>
                        </div>
                        <div class="cost-scenario">
                            <label>기타 비용 고정비</label>
                            <div class="scenario-input-group">
                                <label>평균 성장률 (%)</label>
                                <input type="number" id="other-fixed-mean" placeholder="평균 성장률 (%)" step="0.1">
                            </div>
                            <div class="scenario-input-group">
                                <label>표준편차 (%)</label>
                                <input type="number" id="other-fixed-std" placeholder="표준편차 (%)" step="0.1">
                            </div>
                        </div>
                    </div>
                    
                    <!-- 동적 비용 항목들의 고정비 성장률 -->
                    <div id="dynamicCostGrowthScenarios">
                        <!-- 동적으로 생성되는 고정비 성장률 설정들 -->
                    </div>
                </div>



                <div class="form-actions">
                    <button type="button" id="prevToPage1" class="btn-secondary">이전 단계로</button>
                    <button type="button" id="nextToPage3" class="btn-primary">다음 단계로</button>
                </div>
            </div>

            <!-- Page 3: 모델 시각화 -->
            <div class="page" id="page3">
                <h2>모델 시각화</h2>
                
                <!-- 사업부별 시나리오 선택 -->
                <div class="scenario-selection-section">
                    <h3>사업부별 시나리오 선택</h3>
                    <div class="scenario-selectors">
                        <div class="form-group">
                            <label for="segment1Scenario">사업부 1 시나리오</label>
                            <select id="segment1Scenario">
                                <option value="optimistic">낙관적</option>
                                <option value="base" selected>기본</option>
                                <option value="pessimistic">비관적</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="segment2Scenario">사업부 2 시나리오</label>
                            <select id="segment2Scenario">
                                <option value="optimistic">낙관적</option>
                                <option value="base" selected>기본</option>
                                <option value="pessimistic">비관적</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="segment3Scenario">사업부 3 시나리오</label>
                            <select id="segment3Scenario">
                                <option value="optimistic">낙관적</option>
                                <option value="base" selected>기본</option>
                                <option value="pessimistic">비관적</option>
                            </select>
                        </div>
                    </div>
                    <button type="button" id="updateVisualization" class="btn-primary">차트 업데이트</button>
                </div>

                <!-- 연도별 차트 -->
                <div class="annual-charts-section">
                    <h3>연도별 재무 지표</h3>
                    <div class="chart-container">
                        <canvas id="annualCharts"></canvas>
                    </div>
                </div>

                <!-- 요약 테이블 -->
                <div class="summary-table-section">
                    <h3>재무 요약</h3>
                    <div class="table-container">
                        <table id="financialSummaryTable" class="summary-table">
                            <thead>
                                <tr>
                                    <th>연도</th>
                                    <th>매출</th>
                                    <th>비용</th>
                                    <th>영업이익</th>
                                    <th>현재가치</th>
                                </tr>
                            </thead>
                            <tbody id="financialSummaryBody">
                                <!-- 데이터가 동적으로 추가됨 -->
                            </tbody>
                            <tfoot>
                                <tr class="terminal-value-row">
                                    <td><strong>Terminal Value</strong></td>
                                    <td colspan="2"></td>
                                    <td id="terminalValue">-</td>
                                    <td id="terminalValuePV">-</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" id="prevToPage2" class="btn-secondary">이전 단계로</button>
                    <button type="button" id="nextToPage4" class="btn-primary">다음 단계로</button>
                </div>
            </div>

            <!-- Page 4: 시뮬레이션 및 가치평가 -->
            <div class="page" id="page4">
                <h2>시뮬레이션 및 가치평가</h2>
                <div class="simulation-controls">
                    <div class="form-group">
                        <label for="iterationCount">시뮬레이션 횟수</label>
                        <input type="number" id="iterationCount" value="1500" min="100" max="10000" step="100">
                    </div>
                    <button type="button" id="startSimulation" class="btn-primary">시뮬레이션 시작</button>
                    <button type="button" id="stopSimulation" class="btn-secondary" style="display: none;">중지</button>
                </div>

                <div class="progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <div class="progress-text">0%</div>
                </div>

                <div class="simulation-results" style="display: none;">
                    <!-- 큰 분포도 차트 -->
                    <div class="result-card large-chart">
                        <h3>기업가치 분포</h3>
                        <canvas id="valueDistributionChart"></canvas>
                    </div>
                    
                    <!-- 통계 정보 -->
                    <div class="result-card">
                        <h3>핵심 통계 지표</h3>
                        <div class="statistics">
                            <div class="stat-item">
                                <span class="stat-label">평균</span>
                                <span class="stat-value" id="meanValue">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">중간값</span>
                                <span class="stat-value" id="medianValue">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">표준편차</span>
                                <span class="stat-value" id="stdDevValue">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">최소값</span>
                                <span class="stat-value" id="minValue">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">최대값</span>
                                <span class="stat-value" id="maxValue">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">25% 분위수</span>
                                <span class="stat-value" id="percentile25">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">75% 분위수</span>
                                <span class="stat-value" id="percentile75">-</span>
                            </div>
                            <div class="stat-item current-value-item">
                                <span class="stat-label">현재가치</span>
                                <span class="stat-value" id="currentValue">-</span>
                            </div>
                        </div>
                    </div>
                </div>



                <div class="form-actions">
                    <button type="button" id="prevToPage3" class="btn-secondary">이전 단계로</button>
                    <button type="button" id="nextToPage5" class="btn-primary" disabled>다음 단계로</button>
                </div>
            </div>

            <!-- Page 5: 투자 분석 -->
            <div class="page" id="page5">
                <h2>투자 분석</h2>

                <div class="investment-results" style="display: none;">
                    <!-- 큰 Upside/Downside 차트 -->
                    <div class="result-card large-chart">
                        <h3>Upside/Downside 분포</h3>
                        <canvas id="upsideDownsideChart"></canvas>
                    </div>
                    
                    <!-- 투자 분석 지표 -->
                    <div class="result-card">
                        <h3>투자 분석 지표</h3>
                        <div class="investment-stats">
                            <div class="stat-item">
                                <span class="stat-label">기대 수익률</span>
                                <span class="stat-value" id="expectedReturn">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">손익비</span>
                                <span class="stat-value" id="profitLossRatio">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">샤프 비율</span>
                                <span class="stat-value" id="sharpeRatio">-</span>
                            </div>
                        </div>
                    </div>
                </div>



                <div class="form-actions">
                    <button type="button" id="prevToPage4" class="btn-secondary">이전 단계로</button>
                </div>
            </div>

                         <!-- Page 6: 설정 -->
             <div class="page" id="page6">
                 <h2>설정</h2>
                 
                 <div class="settings-container">
                     <div class="settings-section">
                         <h3>계정 설정</h3>
                         <div class="setting-item">
                             <label>이메일</label>
                             <span id="settings-email">-</span>
                         </div>
                         <div class="setting-item">
                             <label>계정 생성일</label>
                             <span id="settings-created">-</span>
                         </div>
                     </div>
                     
                     <div class="settings-section">
                         <h3>API 설정</h3>
                         <div class="setting-item">
                             <label for="gemini-api-key">Gemini API 키</label>
                             <div class="setting-control">
                                 <input type="password" id="gemini-api-key" placeholder="Gemini API 키를 입력하세요">
                                 <button type="button" id="save-api-key" class="btn-primary">저장</button>
                             </div>
                         </div>
                         <div class="setting-item">
                             <label>API 키 상태</label>
                             <span id="api-key-status">미설정</span>
                         </div>
                     </div>
                     
                     <div class="settings-section">
                         <h3>데이터 관리</h3>
                         <div class="setting-item">
                             <label>Portfolio Manager</label>
                             <button type="button" id="portfolio-manager-btn" class="btn-primary">Portfolio Manager</button>
                         </div>
                         <div class="setting-item">
                             <label>데이터 내보내기</label>
                             <button type="button" id="export-data-settings" class="btn-secondary">Portfolio에 업로드</button>
                         </div>
                         <div class="setting-item">
                             <label>데이터 가져오기</label>
                             <button type="button" id="import-data-settings" class="btn-secondary">Portfolio에서 가져오기</button>
                         </div>
                     </div>
                 </div>

                 <div class="form-actions">
                     <button type="button" id="back-to-main" class="btn-primary">메인으로 돌아가기</button>
                 </div>
             </div>

             <!-- Page 7: Portfolio Manager -->
             <div class="page" id="page7">
                 <div class="portfolio-header">
                     <h2>Portfolio Manager</h2>
                     <p>공유된 기업 가치 평가 데이터를 관리합니다</p>
                 </div>
                 
                 <div class="portfolio-container">
                     <div class="portfolio-actions">
                         <button type="button" id="back-to-valuation" class="btn-primary">Valuation Assistant로 돌아가기</button>
                         <button type="button" id="refresh-portfolio" class="btn-secondary">새로고침</button>
                     </div>
                     
                     <div class="portfolio-list" id="portfolio-list">
                         <!-- 업로드된 데이터들이 여기에 동적으로 추가됩니다 -->
                         <div class="portfolio-loading">
                             <p>데이터를 불러오는 중...</p>
                         </div>
                     </div>
                 </div>
             </div>
        </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-analytics-compat.js"></script>
    
    <!-- Firebase 설정 -->
    <script src="js/firebaseConfig.js"></script>
    <script>
        // Firebase 초기화 및 설정
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // 앱 인스턴스 생성
                window.valueWebApp = new ValueWebApp();
                
                // Firebase 초기화 및 앱 시작
                if (window.firebaseConfig) {
                    window.firebaseConfig.initializeFirebase();
                    window.firebaseConfig.setupAuthEventListeners();
                }
                
                // 앱 초기화
                window.valueWebApp.initializeApp();
                
            } catch (error) {
                console.error('앱 초기화 오류:', error);
            }
        });
    </script>
    
    <!-- 애플리케이션 스크립트 -->
    <script src="js/dataManager.js"></script>
    <script src="js/simulation.js"></script>
    <script src="js/app.js"></script>
</body>
</html> 